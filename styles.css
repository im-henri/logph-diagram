:root{
  /* Modern, professional dark theme */
  --bg:#070A12;
  --panel:#0B1020;
  --panel2:#0D142B;
  --text:#EEF2FF;
  --muted:#A9B4DA;

  /* Chart / semantic colors */
  --grid:rgba(255,255,255,0.08);
  --dome:#7C9DFF;
  --aux:rgba(200,210,255,0.20);
  --cycle:#FFC857;
  --pt:#FF4D7D;
  --liq:#22D3EE;
  --vap:#A78BFA;
  --twoph:#FBBF24;
  --sc:#94A3B8;
  --oneph:#34D399;
  --ok:#6EE7B7;
  --warn:#FBBF24;
  --danger:#FB7185;

  /* UI tokens */
  --radius:18px;
  --radiusSm:12px;
  --border:rgba(255,255,255,0.10);
  --border2:rgba(255,255,255,0.16);
  --shadow:0 22px 68px rgba(0,0,0,0.55);
  --shadowSoft:0 14px 40px rgba(0,0,0,0.36);
  --glassBar:rgba(10,12,18,0.68);
  --glassPanel:rgba(10,12,18,0.50);
  --surfaceTop:rgba(255,255,255,0.06);
  --surfaceBottom:rgba(255,255,255,0.02);
  --focusRing:rgba(124,157,255,0.26);
}

html[data-theme="dark"]{color-scheme:dark}
html[data-theme="light"]{color-scheme:light}

/* Light theme overrides */
html[data-theme="light"]{
  /* Modern, crisp light theme */
  --bg:#F6F8FF;
  --panel:#FFFFFF;
  --panel2:#F4F6FB;
  --text:#0B1220;
  --muted:#475569;

  --grid:rgba(2,6,23,0.10);
  --aux:rgba(2,6,23,0.18);
  --dome:#2563EB;
  --cycle:#F59E0B;
  --pt:#E11D48;

  --radius:18px;
  --radiusSm:12px;
  --border:rgba(2,6,23,0.10);
  --border2:rgba(2,6,23,0.16);
  --shadow:0 22px 68px rgba(2,6,23,0.12);
  --shadowSoft:0 14px 38px rgba(2,6,23,0.10);
  --glassBar:rgba(255,255,255,0.78);
  --glassPanel:rgba(255,255,255,0.70);
  --surfaceTop:rgba(2,6,23,0.030);
  --surfaceBottom:rgba(2,6,23,0.018);
  --focusRing:rgba(37,99,235,0.20);
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:
  radial-gradient(900px 520px at 14% -18%, rgba(124,157,255,0.26), transparent 56%),
  radial-gradient(760px 460px at 110% 10%, rgba(255,200,87,0.12), transparent 56%),
  radial-gradient(760px 520px at 88% 122%, rgba(255,77,125,0.10), transparent 58%),
  repeating-linear-gradient(0deg, rgba(255,255,255,0.05) 0 1px, transparent 1px 84px),
  repeating-linear-gradient(90deg, rgba(255,255,255,0.04) 0 1px, transparent 1px 84px),
  var(--bg);
color:var(--text);
overflow:hidden;
-webkit-font-smoothing:antialiased;
-moz-osx-font-smoothing:grayscale}

html[data-theme="light"] body{
  background:
    radial-gradient(900px 520px at 20% -20%, rgba(59,130,246,0.18), transparent 55%),
    radial-gradient(800px 460px at 110% 0%, rgba(245,158,11,0.12), transparent 55%),
    radial-gradient(680px 420px at 90% 120%, rgba(225,29,72,0.08), transparent 55%),
    var(--bg);
}

.app{height:100vh;height:100dvh;display:flex;flex-direction:column;overflow:hidden}

/* Top bar */
.appBar{display:flex;gap:14px;align-items:center;justify-content:flex-end;padding:14px 18px;border-bottom:1px solid var(--border);background:var(--glassBar);backdrop-filter:blur(16px);position:sticky;top:0;z-index:10;box-shadow:var(--shadowSoft)}
.appBar::after{content:"";position:absolute;left:0;right:0;bottom:-1px;height:1px;background:linear-gradient(90deg, rgba(124,157,255,0.0), rgba(124,157,255,0.55), rgba(255,200,87,0.35), rgba(255,77,125,0.45), rgba(124,157,255,0.0));opacity:0.85;pointer-events:none}

.appTitle{min-width:260px}
.appName{font-size:15px;font-weight:720;letter-spacing:0.25px}
.appSub{color:var(--muted);font-size:12px;margin-top:3px;max-width:78ch}

.appActions{display:flex;gap:10px;align-items:flex-end;flex-wrap:wrap;justify-content:flex-end}

.badge{display:inline-flex;align-items:center;height:32px;padding:0 10px;border-radius:999px;border:1px solid var(--border2);background:rgba(255,255,255,0.06);color:var(--text);font-size:12px;opacity:0.92;white-space:nowrap}

/* Layout */
.layout{display:grid;grid-template-columns:minmax(380px, 440px) 1fr;gap:16px;padding:16px;flex:1;min-height:0;overflow:hidden;max-width:1480px;margin:0 auto;width:100%}

.sidebar{display:flex;flex-direction:column;gap:12px;min-height:0;resize:horizontal;overflow:auto;min-width:360px;max-width:600px;padding:14px;background:var(--glassPanel);backdrop-filter:blur(14px);border:1px solid var(--border);border-radius:calc(var(--radius) + 2px);box-shadow:var(--shadow)}
.sidebarTop{display:none}
.sidebarTitle{font-size:12px;font-weight:700;letter-spacing:0.2px}

.card{background:linear-gradient(180deg, var(--surfaceTop), var(--surfaceBottom));border:1px solid var(--border);border-radius:var(--radius);padding:14px;box-shadow:0 10px 30px rgba(0,0,0,0.22)}
.cardTitle{font-size:12px;font-weight:700;color:var(--text);opacity:0.92;margin-bottom:8px;letter-spacing:0.2px}
.hint{color:var(--muted);font-size:12px;line-height:1.4}

.diagnostics{color:var(--text);opacity:0.90;font-size:12px;line-height:1.35}
.diagnostics .muted{color:var(--muted);opacity:1}
.diagnostics .warn{color:var(--warn);opacity:1}
.diagnostics .ok{color:var(--ok);opacity:1}
.diagnostics .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
.diagnostics hr{border:0;border-top:1px solid var(--border);margin:10px 0}
.diagnostics ul{margin:6px 0 0 18px;padding:0}
.diagnostics li{margin:4px 0}

.row{display:flex;gap:8px;align-items:end;flex-wrap:wrap}
.grow{flex:1 1 auto;min-width:180px}

.field{display:flex;flex-direction:column;gap:6px;color:var(--muted);font-size:12px}
.field > span{line-height:1}

select,button,input{background:rgba(255,255,255,0.065);border:1px solid var(--border2);color:var(--text);padding:9px 11px;border-radius:var(--radiusSm);outline:none;backdrop-filter:blur(10px)}
select:focus,button:focus,input:focus{border-color:var(--dome);box-shadow:0 0 0 4px var(--focusRing)}

/* Make dropdown menus readable (browser support varies, but helps in most) */
select{color:var(--text);background-color:rgba(255,255,255,0.07)}
select option{background:var(--panel2);color:var(--text)}

.btn{cursor:pointer;user-select:none;transition:transform 0.06s ease, border-color 0.16s ease, background 0.16s ease, box-shadow 0.16s ease;box-shadow:none}
.btn:hover{border-color:rgba(255,255,255,0.26);background:rgba(255,255,255,0.11);box-shadow:0 12px 26px rgba(0,0,0,0.22)}
.btn:active{transform:translateY(1px)}
.btn:disabled{opacity:0.55;cursor:not-allowed;transform:none}
.btnDanger{border-color:rgba(251,113,133,0.35)}
.btnDanger:hover{border-color:rgba(251,113,133,0.7);background:rgba(251,113,133,0.12)}

.tableWrap{margin-top:10px;overflow-y:auto;overflow-x:hidden;border-radius:12px;border:1px solid var(--border)}
table{width:100%;border-collapse:separate;border-spacing:0;font-size:12px;table-layout:fixed}
th,td{border-bottom:1px solid var(--border);padding:6px 6px;text-align:left;vertical-align:top;min-width:0}
th{color:var(--muted);font-weight:700;background:rgba(0,0,0,0.14);position:sticky;top:0;z-index:2}
tbody tr:hover td{background:rgba(255,255,255,0.035)}
.tableWrap table th:first-child,.tableWrap table td:first-child{width:28px;padding-left:6px;padding-right:4px}
td input,td select{width:100%;min-width:0;max-width:100%;padding:6px 6px;border-radius:10px}

details.card{padding:0}
details.card > summary{list-style:none;cursor:pointer;padding:12px;margin:0}
details.card > summary::-webkit-details-marker{display:none}
details.card .hint{padding:0 12px 12px 12px}
details.card ul{margin:6px 0 0 18px}
details.card li{margin:6px 0}

/* Chart */
.chartWrap{background:linear-gradient(180deg, rgba(255,255,255,0.055), rgba(255,255,255,0.018));border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;min-height:0;display:flex;flex-direction:column;box-shadow:var(--shadow)}

.chartAxisHeader{padding:10px 12px 0 12px;display:flex;flex-direction:column;align-items:flex-start;gap:2px;color:var(--muted);font-size:12px;letter-spacing:0.2px;pointer-events:none}

.chartStage{position:relative;flex:1;min-height:0;display:flex;align-items:center;justify-content:center}

.chartWrap.isLoading .chart{opacity:0.22}

.chartOverlay{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;background:rgba(0,0,0,0.50);backdrop-filter:blur(2px);z-index:5;pointer-events:all}
.chartOverlay[hidden]{display:none}
.chartOverlayText{color:var(--text);font-size:13px;letter-spacing:0.2px;opacity:0.95}
.chartSpinner{width:34px;height:34px;border-radius:50%;border:3px solid rgba(255,255,255,0.22);border-top-color:rgba(255,255,255,0.82);animation:spin 0.9s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

.chart{width:100%;min-height:0;display:block;max-width:100%;max-height:100%;touch-action:none;-webkit-user-select:none;user-select:none}

/* Responsive */
/* Phone / portrait-first UX: chart dominates, controls in a bottom sheet.
   Keep width fallback for small devices in landscape. */
@media (orientation: portrait), (max-width: 980px){
  .appBar{gap:8px;padding:10px 12px}
  .appTitle{min-width:0}
  .appName{font-size:13px}
  .appSub{display:none}

  .badge{display:none}
  #clearBtn{display:none}

  .appActions{width:100%;justify-content:space-between;align-items:center}
  .appActions .field{flex:1 1 170px}
  #fluidSelect{width:100%}
  .panelBtn{flex:0 0 auto}

  /* Chart-first layout: sidebar becomes an overlay drawer */
  .layout{grid-template-columns:1fr;grid-template-rows:minmax(0,1fr);padding:10px;gap:10px}
  .chartWrap{grid-row:1}

  .sidebarTop{display:flex;align-items:center;justify-content:space-between;gap:10px;position:sticky;top:0;z-index:5;
    padding:10px 12px;margin:-12px -12px 0 -12px;
    border-bottom:1px solid var(--border);
    background:var(--glassBar);backdrop-filter:blur(14px)}

  .sidebar{
    position:fixed;
    left:10px; right:10px;
    bottom:10px;
    max-height:74vh;
    min-width:0; max-width:none;
    resize:none;
    padding:12px;
    border-radius:20px;
    background:var(--glassPanel);
    border:1px solid var(--border);
    box-shadow:0 28px 80px rgba(0,0,0,0.55);
    transform:translateY(calc(100% + 16px));
    transition:transform 0.18s ease;
    z-index:20;
  }
  .app.panelOpen .sidebar{transform:translateY(0)}

  .row{flex-direction:column;align-items:stretch}
  .grow{min-width:0}

  .card{padding:10px}
  th,td{padding:7px 6px}
  td input,td select{min-width:0}

  /* Keep chart dominant */
  .chart{min-height:0}

}

@media (max-width: 420px){
  .badge{height:30px;font-size:11px}
  select,button,input{padding:8px 10px}
  table{font-size:11px}
}

/* Make primary actions look more intentional */
#panelBtn{border-color:rgba(124,157,255,0.62);background:linear-gradient(180deg, rgba(124,157,255,0.28), rgba(124,157,255,0.12))}
#panelBtn:hover{border-color:rgba(124,157,255,0.88);background:linear-gradient(180deg, rgba(124,157,255,0.36), rgba(124,157,255,0.16))}

#saveBtn{border-color:rgba(110,231,183,0.35)}
#saveBtn:hover{border-color:rgba(110,231,183,0.60);background:rgba(110,231,183,0.10)}

/* Desktop: sidebar is always visible, so hide the drawer toggle. */
@media (min-width: 981px) and (orientation: landscape){
  #panelBtn{display:none}
}

/* When the controls drawer is open (portrait), dim the chart behind it. */
.app.panelOpen::before{content:"";position:fixed;inset:0;background:rgba(0,0,0,0.45);backdrop-filter:blur(2px);z-index:15}

.axisText{font-size:11px;fill:var(--muted)}
.axisLine{stroke:rgba(255,255,255,0.22);stroke-width:1.2}
.gridLine{stroke:var(--grid);stroke-width:1}
.gridLineMajor{stroke:rgba(255,255,255,0.14);stroke-width:1}
.domeFill{fill:rgba(126,161,255,0.10);stroke:none}
.dome{fill:none;stroke:var(--dome);stroke-width:2}
.aux{fill:none;stroke:var(--aux);stroke-width:1}
.auxCurves{pointer-events:none}
.auxCurve{fill:none;stroke-width:1.3;stroke-dasharray:5 5;opacity:0.85}
.auxCurve.isotherm{stroke:rgba(110,231,183,0.42)}
.auxCurve.quality{stroke:rgba(126,161,255,0.40)}
.auxLabel{font-size:10px;fill:rgba(255,255,255,0.70)}
.auxLabel.isotherm{fill:rgba(110,231,183,0.80)}
.auxLabel.quality{fill:rgba(126,161,255,0.78)}
.cycle{fill:rgba(255,209,102,0.10);stroke:var(--cycle);stroke-width:2}
.cycle.placeholderCycle{fill:none;stroke:rgba(255,255,255,0.22);stroke-width:2;stroke-dasharray:6 6}
.point{fill:var(--pt);stroke:rgba(0,0,0,0.4);stroke-width:1;cursor:grab}
.point.placeholder{fill:rgba(255,255,255,0.25);stroke:rgba(255,255,255,0.35)}
.point.phaseLiq{fill:var(--liq)}
.point.phaseVap{fill:var(--vap)}
.point.phase2p{fill:var(--twoph)}
.point.phaseSC{fill:var(--sc)}
.point.phase1p{fill:var(--oneph)}
.point:active{cursor:grabbing}
.pointLabel{font-size:11px;fill:var(--text)}
.guideLine{stroke:rgba(255,255,255,0.35);stroke-width:1;stroke-dasharray:4 4}
.valueLabel{font-size:11px;fill:rgba(255,255,255,0.92)}
.valueLabelBg{fill:rgba(0,0,0,0.35);stroke:rgba(255,255,255,0.12);stroke-width:1}
.valueLeader{stroke:rgba(255,255,255,0.32);stroke-width:1}
